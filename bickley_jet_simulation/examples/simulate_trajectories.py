# -*- coding: utf-8 -*-
"""simulate_trajectories.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1OqQkFbJ-FctDA6D9H3zDcFq2dtkdFDAd
"""

"""
simulate_trajectories.py
------------------------

Integrates Lagrangian particle trajectories in the Bickley Jet using odeint.
Saves trajectories to a NumPy file for later visualization.
"""

import numpy as np
from scipy.integrate import odeint
import matplotlib.pyplot as plt

from src.bickley_trajectories import BickleyJet
from src.bickley_parameters import params
from src.domain_setup import get_domain

# ----------------------------------------------------
# Domain boundaries for sampling
# ----------------------------------------------------
_, _, _, _, xBound, yBound = get_domain()

# ----------------------------------------------------
# Time span for integration
# ----------------------------------------------------
t_final = 10
dt = 0.05
times = np.arange(0, t_final + dt, dt)

# ----------------------------------------------------
# Generate random initial conditions
# ----------------------------------------------------
numTraj = 100
ICs = np.zeros((numTraj, 2))

for i in range(numTraj):
    ICs[i, 0] = np.random.uniform(xBound[0], xBound[1])
    ICs[i, 1] = np.random.uniform(yBound[0], yBound[1])

# ----------------------------------------------------
# Integrate trajectories
# ----------------------------------------------------
Traj = []

for i in range(numTraj):
    sol = odeint(BickleyJet, ICs[i], times)
    sol[:, 0] = sol[:, 0] % xBound[1]  # enforce periodicity in x
    Traj.append(sol)

Traj = np.array(Traj)

# ----------------------------------------------------
# Save to file
# ----------------------------------------------------
np.save("trajectories.npy", Traj)
print("Saved trajectories to trajectories.npy")

# ----------------------------------------------------
# Optional quick visualization
# ----------------------------------------------------
plt.figure(figsize=(12, 4))
for i in range(numTraj):
    plt.plot(Traj[i, :, 0], Traj[i, :, 1], linewidth=0.5)

plt.xlim(xBound)
plt.ylim(yBound)
plt.xlabel("x (Mm)")
plt.ylabel("y (Mm)")
plt.title("Sample Bickley Jet Trajectories")
plt.tight_layout()
plt.show()